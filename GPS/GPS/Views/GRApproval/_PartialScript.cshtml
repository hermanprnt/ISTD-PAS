<script type="text/javascript">

$(document).ready(function () {
    onClear();
    $("#txtdateinput-docdate").todaterangepicker();
    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    })
    //show datepicker when clicking on the icon
	.next().on(ace.click_event, function () {
		$(this).prev().focus();
    });
    $('#txtdateinput-docdate').addClass('mandatory');

    var dt = getCurrentDate();
    $('#txtdateinput-docdate').val(dt + ' - ' + dt);

    if (!$('#txtDivision').val()) {
        $('#txtDivision').prop('selectedIndex', 0);
    }
});

    $("#tScrollBody").scroll(function () {
        $("#tScrollHead").scrollLeft($("#tScrollBody").scrollLeft());
        $("#tScrollFilter").scrollLeft($("#tScrollBody").scrollLeft());
    });

    function onGetData(page) {
        if ($('#txtdateinput-docdate').val().length < 20) {
            $.messagebox.show(
                "Search Data",
                "ERR00004 : Doc Date can not be empty.",
                "ERR",
                "SINGLE",
                "",
                ""
            );
            return;
        }


    $.ajax({
        type: "POST",
        url: "@Html.Toyota().Page.GetActionUrl("SearchData")",
        data: {
            Display: $("#cbodisplay").val() ,
            Page:page,
            //START_DOC_DATE : $("#txtDocDateFrom").val(),
            //END_DOC_DATE : $("#txtDocDateTo").val(),
            MAT_DOC_NO: $("#txtReceivingNumber").val(),
            PLANT_CD: $("#txtPlant").val(),
            SLOC_CD: $("#txtSloc").val(),
            HEADER_TEXT: $("#txtHeaderText").val(),
            DIVISION_ID: $('#txtDivision').val(),
            PR_COORDINATOR: $('#txtCoordinator').val(),
            USER_TYPE: $('#txtUserType').val(),
            DocDateDateRange: $('#txtdateinput-docdate').val()
        },
        success: function (data) {
            $("#divtable").html(data);
        },
        error: function (returnResult) {
            console.log(returnResult);
            $.messagebox.show(
                "Approve GR",
                returnResult,
                "ERR",
                "SINGLE",
                "",
                ""
            );
        }
    });
    }

    function onGetDataDetail(page) {
    $.ajax({
        type: "POST",
        url: "@Html.Toyota().Page.GetActionUrl("SearchDataDetail")",
        data: {
            Display: $("#cbodisplaydetail").val() ,
            Page:page,
            MAT_DOC_NO: $("#matdocnoPopUp").val(),
            PO_NO: $("#ponumberpopup").val(),
            HEADER_TEXT: $("#headertxtpopup").val(),
        },
        success: function (data) {
            $("#divtabledetail").html(data);
        }
    });
}

function onClear() {
    $("#txtReceivingNumber").val('');
    $("#txtPlant").val('');
    $("#txtSloc").val(''),
    $("#txtHeaderText").val(''),
    $("#txtdateinput-docdate").val('')
    $('#txtDivision').val('');
    $('#txtCoordinator').val('');
    $('#txtUserType').val('');
    $("input[id^=cb-]").each(function(i,a){
        a.checked = false;
    });

    ClearGrid(1);
}

function ClearGrid(page) {
    $.ajax({
        type: "POST",
        url: "@Html.Toyota().Page.GetActionUrl("SearchData")",
        data: {
            Display: $("#cbodisplay").val() ,
            Page:page,
            MAT_DOC_NO: 'NULLSTATE',
            PLANT_CD: 'NULLSTATE',
            SLOC_CD: 'NULLSTATE',
            HEADER_TEXT: 'NULLSTATE'
        },
        success: function (data) {
            $("#divtable").html(data);
        }
    });
}

    function OnDetail(matdocno, pono, headertxt) {
        $.ajax({
        type: "POST",
        url: "@Html.Toyota().Page.GetActionUrl("DetailData")",
        data: {
            MAT_DOC_NO: matdocno,
            PO_NO: pono,
            HEADER_TEXT: headertxt
        },
        success: function (data) {
            $("#detailContent").html(data);
            $('#detail-container').modal();
        }
        });

    }

    function getCurrentDate() {
        const today = new Date();
        const yyyy = today.getFullYear();
        let mm = today.getMonth() + 1; // Months start at 0!
        let dd = today.getDate();

        if (dd < 10) dd = '0' + dd;
        if (mm < 10) mm = '0' + mm;

        return dd + '.' + mm + '.' + yyyy;
    }

    function plantChange(v) {
        if (!v) {
            $("#txtSloc option").show();
        }
        else {
            $("#txtSloc").children('option').hide();
            $("#txtSloc").children("option[plant_cd^=" + v + "]").show()
            $("#txtSloc option[plant_cd=all]").show();
        }
    }

$.fn.addOption = function (optText, optValue) {
    var option = new Option(optText, optValue);
    return this.append(option);
    };

    function doApprove() {

        if ($(".grid-checkbox-body:checked").length == 0) {
            $.messagebox.show(
                "GR Approval",
                "MVISSTD008E : At least one record should be selected for approve operation",
                "ERR",
                "SINGLE",
                "",
                ""
            )
            return;
        }

        $('#approve-confirm').modal('show');
    }
</script>